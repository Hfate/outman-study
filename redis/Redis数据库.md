# Redis数据库

+ 简介
    
    Redis服务器将所有数据库都保存在服务器状态 redis.h /redisServer结构的db数组中，db数组的每个项都是一个redis.h/redisDb结构，每个redisDb结构代表一个数据库
    ```
    struct redisServer{
        // 一个数组，保存着服务器中所有的数据库
        redisDb *db;
        // 服务器的数量
        int dbnum;
        // 一个链表，保存了所有客户端状态结构
        list *clients;              /* List of active clients */
    }
    ```
  
    ![avatar](https://outman-1252077993.cos.ap-nanjing.myqcloud.com/1301290-20190819211037419-1542469776.png)


+ 总结
    + redis服务器的所有数据库都保存在redisServer.db数组中，而数据库的数量则由redisServer.dbnum属性保存。
    + 客户端通过修改目标数据库指针，让它指向redisServer.db数组中的不同元素来切换不同的数据库。
    + 数据库主要是由dict和expires两个字典构成，其中dict字典负责保存键值对，而expires字典则负责保存键的过期时间
    + 因为数据库由字典构成，所以对数据库的操作都是建立在字典之上
    + 数据库的键总是一个字符串对象，而值可以是任意一种Redis对象类型，包括字符串对象，哈希表对象，集合对象，列表对象，和有序集合对象，分别对应字符串键，哈希表键，集合键，列表键，和有序集合键。
    + expires字典指向数据库中的某个键，而值则记录了数据库键的过期时间，过期时间是一个以毫秒为单位的unix时间戳。
    + Redis使用惰性删除和定期删除两种策略来删除过期的键
    + 执行SAVE命令或者BGSAVE命令所产生的新RDB文件不会包含已过期的键。
    + 执行BGREWRITEAOF命令所产生的新的重写AOF文件不会包含过期的键。
    + 当一个过期键被删除之后，服务器会追加一条DEL命令到现有AOF文件的末尾，并向所有从服务器发送一条DEL命令
    + 从服务器即使发现过期键也不会自作主张的删除它，而是等待主节点发来的DEL命令，这种统一的，中心化的思想可以保证主从服务器数据的一致性
    + 当redis命令对数据库进行修改之后，服务器会根据配置向客户端发送数据库的通知
